syntax = "proto3";

option csharp_namespace = "TradeBot.Account.AccountService.v1";

package tradebot.account.account_service.v1;

service Account {
	// Сервис для входа в аккаунт или его регистрации.
	rpc Login (LoginRequest) returns (LoginReply); // Метод входа в аккаунт
	rpc Logout (SessionRequest) returns (LogoutReply); // Метод выхода из аккаунта
	rpc Register (RegisterRequest) returns (RegisterReply); // Метод регистрации аккаунта
	rpc IsValidSession (SessionRequest) returns (SessionReply); // Проверка текущего пользователя на валидность по Id сессии
	rpc CurrentAccountData (SessionRequest) returns (CurrentAccountReply); // Получение данных текущего пользователя
	
	// Методы для управления данными биржи.
	rpc AddExchangeAccess(AddExchangeAccessRequest) returns (AddExchangeAccessReply); // Добавление новой биржи для текущего пользователя
	rpc AllExchangesBySession (SessionRequest) returns (AllExchangesBySessionReply); // Получение массива бирж текущего пользователя
	rpc DeleteExchangeAccess (DeleteExchangeAccessRequest) returns (DeleteExchangeAccessReply);
	rpc ExchangeBySession (ExchangeBySessionRequest) returns (ExchangeBySessionReply);
}

message LoginRequest {
	// Данные для входа в аккаунт.
	string email = 1;
	bool save_exchanges_after_logout = 2;
	string password = 3;
}

message LoginReply {
	// Ответ на запрос о входе в аккаунт.
	ActionCode result = 1;
	string message = 2;
	string session_id = 3;
}

message LogoutReply {
	// Ответ на запрос о выходе из аккаунта
	ActionCode result = 1;
	string message = 2;
}

message RegisterRequest {
	// Данные для регистрации аккаунта.
	string email = 1;
	string firstname = 2;
	string lastname = 3;
	string phone_number = 4;
	string password = 5;
	string verify_password = 6;
}

message RegisterReply {
	// Ответ на запрос о регистрации аккаунта.
	ActionCode result = 1;
	string message = 2;
}

message SessionRequest {
	// Запрос на передачу сессии.
	string session_id = 1;
}

message SessionReply {
	// Результат проверки сессии на валидность.
	bool is_valid = 1;
	string message = 2;
}

message CurrentAccountReply {
	// Получение данных текущего пользователя.
	ActionCode result = 1;
	string message = 2;
	AccountInfo current_account = 3;
}

message AddExchangeAccessRequest {
	// Запрос на добавление биржи для текущего пользователя.
	string session_id = 1;
	ExchangeCode code = 2;
	string exchange_name = 3;
	string token = 4;
	int32 secret = 5;
}

message AddExchangeAccessReply {
	// Ответ на добавление биржи для текущего пользователя.
	ActionCode result = 1;
	string message = 2;
}

message AllExchangesBySessionReply {
	// Получение всех добавленных бирж текущего пользователя.
	ActionCode result = 1;
	string message = 2;
	repeated ExchangeAccessInfo exchanges = 3;
}

message DeleteExchangeAccessRequest {
	// Запрос на удаление записи о бирже для текущего пользователя.
	string session_id = 1;
	int32 exchange_access_id = 2;
}

message DeleteExchangeAccessReply {
	// Ответ на запрос об удалении записи о бирже для текущего пользователя.
	ActionCode result = 1;
	string message = 2;
}

message ExchangeBySessionRequest {
	string session_id = 1;
	ExchangeCode code = 2;
}

message ExchangeBySessionReply {
	ActionCode result = 1;
	string message = 2;
	ExchangeAccessInfo exchange = 3;
}

message AccountInfo {
	//Информация о пользователе, необходимая для отображения в UI
	int32 account_id = 1;
	string firstname = 2;
	string lastname = 3;
	string email = 4;
	string phone_number = 5;
	repeated ExchangeAccessInfo exchanges = 6;
}

message ExchangeAccessInfo {
	// Информация о данных для доступа к бирже.
	int32 exchange_access_id = 1;
	ExchangeCode code = 2;
	string name = 3;
	string token = 4;
	int32 secret = 5;
}

enum ExchangeCode {
	// Коды всех бирж.
	EXCHANGE_CODE_BITMEX = 0;
}

enum ActionCode {
	/*
	* Код результата выполнения входа или регистрации:
	* 0 - успешное выполнение,
	* 1 - пользователь не найден,
	* 2 - пользователь уже существует,
	* 3 - имеется пустое поле ввода,
	* 4 - пароли не совпадают.
	*/
	ACTION_CODE_SUCCESSFUL = 0;
	ACTION_CODE_ACCOUNT_NOT_FOUND = 1;
	ACTION_CODE_ACCOUNT_EXISTS = 2;
	ACTION_CODE_EMPTY_FIELD = 3;
	ACTION_CODE_PASSWORD_MISMATCH = 4;
	ACTION_CODE_IS_NOT_EMAIL = 5;
	ACTION_CODE_EXCHANGE_NOT_FOUND = 6;
}
